{
  "rules": {
    ".read": "auth.uid === 'gulp-service-worker'",
    ".write": "auth.uid === 'gulp-service-worker'",
    "data": {
      "system": {
        ".read": false,
        ".write": false,
        "templates" :{
          ".read": "true",
          ".write": "root.child('auth/user_effective_permissions/' + auth.uid + '/' + ( newData.exists() ? (data.exists() ? 'MODIFY' : 'ADD' ) : 'DELETE') + ' TANJ_TEMPLATE').exists()"
        }
      },
      "by_user": {
        "$userKey": {
          ".read": "auth.uid == $userKey",
          ".write": "auth.uid === $userKey",
          "captures": {
            ".indexOn": "name",
            "$captureKey": {
              ".indexOn": "createdMils"
            }
          },
          "points": {
            "$pointKey": {
              ".indexOn": ["createdMils","when"]
            }
          },
          "prefs": {

          }
        }
      }
    },
    "auth": {
      ".read": "root.child('auth/user_effective_permissions/' + auth.uid + '/VIEW USERS').exists() && root.child('auth/user_effective_permissions/' + auth.uid + '/VIEW USERS').exists()",
      ".write": "auth.uid === 'gulp-service-worker'",
      "permissions": {
        ".read": "true",
        ".write": "root.child('auth/user_effective_permissions/' + auth.uid + '/' + ( newData.exists() ? (data.exists() ? 'MODIFY' : 'ADD' ) : 'DELETE') + ' PERMISSION').exists()"
      },
      "roles": {
        ".read": "true",
        ".write": "root.child('auth/user_effective_permissions/' + auth.uid + '/' + ( newData.exists() ? (data.exists() ? 'MODIFY' : 'ADD' ) : 'DELETE') + ' ROLE').exists()"
      },
      "users": {
        ".read": "root.child('auth/user_effective_permissions/' + auth.uid + '/VIEW USERS').exists()",
        ".write": "root.child('auth/user_effective_permissions/' + auth.uid + '/' + ( newData.exists() ? (data.exists() ? 'MODIFY' : 'ADD' ) : 'DELETE') + ' USER').exists()",
        "$uid": {
          ".read": "auth.uid == $uid",
          ".write": "auth.uid == $uid && (!data.exists() || !newData.exists() || !data.child('email').exists() || newData.child('email').val() == data.child('email').val())"
        }
      },
      "user_granted_permissions": {
        ".read": "true",
        ".write": "root.child('auth/user_effective_permissions/' + auth.uid + '/'  + ( newData.exists() ? 'GRANT' : 'REVOKE')  + ' PERMISSION').exists()"
      },
      "user_effective_permissions": {
        ".read": "root.child('auth/user_effective_permissions/' + auth.uid + '/VIEW USERS').exists()",
        ".write": "root.child('auth/user_effective_permissions/' + auth.uid + '/'  + ( newData.exists() ? 'GRANT' : 'REVOKE') + ' PERMISSION').exists()",
        "$uid": {
          ".read": "auth.uid == $uid"
        }
      },
      "role_permissions": {
        ".read": "auth != null",
        "$uid": {
          ".write": "root.child('auth/user_effective_permissions/' + auth.uid + '/'  + ( newData.exists() ? 'GRANT' : 'REVOKE') + ' PERMISSION').exists()"
        }
      },
      "user_roles": {
        ".read": "auth != null",
        "$uid": {
          ".write": "root.child('auth/user_effective_permissions/' + auth.uid + '/'  + ( newData.exists() ? 'GRANT' : 'REVOKE') + ' ROLE').exists()"
        }
      }
    }
  }
}
